# 애플리케이션 분리의 중요성
- 모듈형 자바스크립트는 애플리케이션을 모듈이라는 단위로 쪼갤 수 있습니다.
- 모듈은 달느 모듈을 가져올 수 있으며, 이 모듈이 또 다른 모듈을 가져올 수도 있습니다.
- 따라서 애플리케이션은 여러 개의 중첩된 모듈로 구성될 수 있습니다.

- 모듈로 구성이 되어있으면 결합이 느슨하여 의존성이 낮아지므로 애플리케이션의 유지보수가 용이해집니다.
- 또한 모듈을 통해 효율적으로 구현하면, 어느 한 부분의 변경이 다른 부분에 어떤 영향을 미칠 수 있는지 쉽게 확인이 가능합니다.

# 모듈 가져오기와 내보내기
- 모듈을 사용하면 각 기능에 맞는 독립적인 단위로 코드를 분리할 수 있다.
- 모듈형 언어가 되기 위해서는 의존성을 가진 모듈을 가져오고, 내보낼 수 있어야 합니다.
- 이건 그냥 import 문이랑 export 문을 예시로 들 수 있습니다.

# 정적으로 모듈 가져오기
- 정적 가져오기는 메인 코드를 실행하기 전에 먼저 모듈을 다운로드하고 실행해야 합니다.
- 따라서 초기 페이지 로드 시 많은 코드를 미리 로드해야 하므로 성능에 문제가 생길 수도 있습니다.
```
import {cakeFactory} from "/modules/cakeFactory.mjs";
// 미리 로드된 정적 가져오기

cakeFactory.oven.makeCupcake( "sprinkles" );
cakeFactory.oven.makeMuffin( "large" );
```

# 동적으로 모듈 가져오기
- 모듈을 초기에 모두 미리 로드하기보다는 필요한 시점에만 로드하는 것이 더 이로울 때가 있다.
- 지연 로딩 모듈을 사용하면 필요한 시점에 로드할 수 있다.
- 예를 들어 사용자가 링크나 버튼을 클릭할 때 로드하게 만들 수 있어 초기 로딩 시간을 줄일 수 있다.
- 동적 가져오기는 함수와 비슷한 새로운 형태의 가져오기이다.
- import(url)는 요청된 모듈의 네임스페이스 객체에 대한 Promise를 반환한다.
- 이 프로미스 객체는 모듈 자체와 모든 모듈 의존성을 가져온 후, 인스턴스화하고 평가한 뒤에 만들어진다.
```ts
form.addEventListener("submit", e => {
    e.preventDefault();
    import("/modules/cakeFactory.js")
        .then(module) => {
            //가져온 모듈 사용하기
            module.oven.makeCupcake("sprinkles");
            module.oven.makeMuffin("large");
        }
})
```
- 동적 가져오기는 await와 함께 사용할 수 있다.
```ts
let module = await import ("/modules/cakeFactory.js");
```

# 사용자 상호작용에 따라 가져오기
- 일부 기능은 사용자가 상호작용할 때만 필요할 수도 있다.
- 채팅 창이나 다이얼로그, 비디오 등이 대표적인 예시가 된다.
- 이런 기능은 페이지 로드 시점에 필요한 게 아니니 사용자가 컴포넌트를 클릭하는 등 상호작용에 따라 로드되는 것이 좋다.
- 동적 가져오기를 활용하면, 실행한 다음에 따라오는 함수를 통해 원하는 기능을 사용할 수 있다.
```ts
const btn = document.querySelector('button');

btn.addEventListener('click', e => {
    e.preventDefault();
    import('lodash.sortby')
        .then(module => module.default)
        .then(sortInput())
        .catch(err => {console.log(err)});
});
```

# 화면에 보이면 가져오기
- 많은 컴포넌트는 처음엔 숨겨져 있다가 사용자가 아래로 스크롤하면 나타나도록 만들어지곤 한다.
- 그러나 사용자가 항상 아래로만 스크롤하는 것은 아니기에 모듈을 지연 로딩으로 구현하면 좋다.
- ```IntersectionObserver API```를 사용하면 컴포넌트가 화면에 보이는지 감지할 수 있고, 이에 따라 모듈을 동적으로 로드할 수도 있다.

# 모듈을 사용하면 생기는 이점
- 모듈형 프로그래밍을 사용하면 다음과 같은 다양한 이점을 얻을 수 있다.
### 한 번만 실행된다
- 기존 스크립트는 DOM에 추가될 때마다 실행되는 반면에 모듈 스크립트는 한 번만 실행된다.
- 자바스크립트 모듈을 사용하면 의존성 트리의 가장 내부에 위치한 모듈이 먼저 실행된다.
- 가장 내부에 위치한 모듈이 먼저 평가되고 여기에 의존하는 모듈에 접근할 수 있다는 것이 이점이다.
### 자동으로 지연 로드된다
- 즉시 로드되지 않기 위해 다른 스크립트 파일은 defer 속성을 붙여야 하지만, 모듈은 자동으로 지연되어 로드된다.
### 유지보수와 재사용이 쉽다
- 모듈은 다른 모듈에 영향을 주지 않고 독립적으로 실행될 수 있는 코드 조각으로 관리된다.
- 이를 통해 여러 다른 함수에서 동일한 코드를 재사용할 수 있다.
### 네임스페이스를 제공한다
- 모듈은 관련 변수와 상수를 위한 개별 공간을 생성하여 글로벌 네임스페이스를 오염시키지 않고 모듈 참조를 통해 사용할 수 있게 해준다.
### 사용하지 않는 코드를 제거한다
- 모듈이 도입되기 전에는 사용하지 않는 코드를 수동으로 제거해야 했다.
- 모듈을 통해 코드를 가져오게 되면 웹팩이나 롤업 같은 번들러를 사용해 사용하지 않는 모듈을 자동으로 제거할 수 있다.
- 이처럼 번들에 추가하기 전에 사용하지 않는 코드를 제거하는 것을 ```트리쉐이킹```이라고 한다.